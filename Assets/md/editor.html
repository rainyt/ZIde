<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>

<body>

    <div id="container" style="width:100%;height:600px;padding: 0px;border:0px solid grey"></div>

    <script src="monaco-editor/min/vs/loader.js"></script>
    <script src="./xml-editor.js"></script>
    <script>
        require.config({ paths: { 'vs': 'monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            var editor = monaco.editor.create(document.getElementById('container'), {
                value: null,
                language: 'xml',
                theme: "vs-dark",
                quickSuggestions:true
            });
            window.editor = editor;
            document.getElementById("container").style.height = document.documentElement.clientHeight + "px";
            editor.layout();
            monaco.languages.registerCompletionItemProvider("xml",new XmlEditorContent());
            editor.onDidChangeModelContent(function(){
                if(window.onCodeChange != null)
                    window.onCodeChange();
            });
            // 
            // monaco.languages.registerCompletionItemProvider("xml", {
            //     provideCompletionItems(model, position) {
            //         // 获取当前行数
            //         const line = position.lineNumber

            //         // 获取当前列数
            //         const column = position.column

            //         // 获取当前输入行的所有内容
            //         const content = model.getLineContent(line)

            //         // 通过下标来获取当前光标后一个内容，即为刚输入的内容
            //         const sym = content[column - 2]

            //         console.log(sym);

            //         return {
            //             suggestions: [{
            //                 label: 'ZImage',
            //                 kind: monaco.languages.CompletionItemKind['Function'], //这里Function也可以是别的值，主要用来显示不同的图标
            //                 insertText: 'ZImage', // 我试了一下，如果没有此项，则无法插入
            //                 detail: '图片对象'
            //             },{
            //                 label: 'width',
            //                 kind: monaco.languages.CompletionItemKind['Function'], //这里Function也可以是别的值，主要用来显示不同的图标
            //                 insertText: 'width', // 我试了一下，如果没有此项，则无法插入
            //                 detail: '宽度'
            //             }]
            //         };
            //     },
            //     triggerCharacters: ['<',"/"," "]  // 写触发提示的字符，可以有多个
            // });
        });
        //注册提示工具
        window.registerCompletionItemProvider = function (item) {
            monaco.languages.registerCompletionItemProvider(item);
        }
        //自适应宽度
        window.onresize = function () {
            if (editor) {
                document.getElementById("container").style.height = document.documentElement.clientHeight + "px";
                editor.layout();
            }
        };
        window.getCodeValue = function () {
            return editor.getValue();
        }
        window.setCodeValue = function (data){
            editor.setValue(data);
        }
    </script>
</body>

</html>